# ctrl4325
`SPI` 通信を介した `STM32L010F4P6` による `EM4325` の制御.  
~~一定間隔もしくは `LPUART` にてコマンドを実行.~~  
EM4325 が UHF RFID リーダより照射される電波をキャッチした場合, AUX ピンが瞬時に立ち上がる. (応答設定は EM4325 のレジスタにより定義されていると思う.)  
そのため, `STM32L010F4P6` の GPIO Pin の1つを入力とし, 電波をキャッチした際にデータを EPC 領域へ書き込みを行う.
なお, 連続した書き込みを防止するため, 書き込み時間を記録し n[秒] 経過したら再度書き込みを可能にするよう実装.


## TODO
* 2022-03-05  
  ~~`SPI` レジスタの定義と実装~~ 実装済み
* 2022-03-11  
  ~~SPIWritePage, メモリ領域書き込み処理の追加.  
  アナログ入力或いは他環境データの読み込み.~~ 実装済み
* 2022-05-08  
  ~~(余力があれば) EM4325 の User 領域は十分な空きが存在するため, いずれか特定アドレスを設定用レジスタとする.~~

## 既知の問題点
* EM4325 の処理周りの強化. SPI 経由で EM4325 よりデータの取得方法として, 正当性のあるデータを取得するまで無限ループさせている処理があるため EM4325 の処理周りで停止する可能性が存在.

## 更新概要
* 2022-03-05  
  基本的なレジスタの定義と初期化処理.  
  `mdelay(msec:uint16_t)` 遅延や `SysTick_handler(void)` を用いた LED 点滅.
* 2022-03-11  
  SPI1 周辺処理の強化. EM4325 SPIGetSensorData Command, SPIReadPage Command の実行確認.
* 2022-03-12  
  SPIWriteWord, udelay16(uint16_t) 実装
* 2022-05-08  
  MPL1151A より SPI 経由で気圧データを取得.  
  気圧データ取得後 EPC 領域最終 2 word への書き込み. EPC 領域長は PC Bits より取得.
* 2022-05-09  
  User 領域 0x10 を設定レジスタとして利用.  
  Bit 8:0 読み込み間隔時間
